sap.ui.define([
		"pwc/portal/eval/ClubEvaluations/controller/BaseController",
		"sap/m/MessageBox",
		"./utilities",
		"sap/ui/model/json/JSONModel",
		"sap/ui/core/routing/History",
		"pwc/portal/eval/ClubEvaluations/service/RepoService",
		"./CreateNewAccountingProgram",
		"./ReviewAccountingProgram"
	], function (BaseController, MessageBox, Utilities, JSONModel, History, RepoService,CreateNewAccountingProgram,ReviewAccountingProgram) {
		"use strict";
		return BaseController.extend("pwc.portal.eval.ClubEvaluations.view.Applications.AccountingPrograms43G.controller.MainAccountingProgram", {
			onInit: function () {
				this.getRouter().getRoute("accountingprogram").attachPatternMatched(this._onObjectMatched, this);
				var that = this;
				this.getOwnerComponent().getModel("User").read("/UserClub", {
				success: function (oData) {
						that.club_dms_id = oData.results[0].club_dms_id;
				},
				error: function (oError) {}
			});
			},
		// onAfterRendering: function () {
  //              if (typeof sap.ui.getCore().AppContext === 'undefined') {
  //                  this.getOwnerComponent().getRouter().navTo("home");
  //                  this.destroy();
  //              }
  //          },
		_onButtonPress: function(oEvent) {

			var sDialogName = "CreateNewAccountingProgram";
			this.mDialogs = this.mDialogs || {};
			var oDialog = this.mDialogs[sDialogName];
			if (!oDialog) {
				oDialog = new CreateNewAccountingProgram(this.getView());
				this.mDialogs[sDialogName] = oDialog;

				// For navigation.
				oDialog.setRouter(this.oRouter);
			}

			var oContext = this.getView().getModel("accountingsystem").createEntry("/accountingsystem");
			oDialog._oControl.setBindingContext(oContext,"accountingsystem");

			oDialog.open();

		},
		_onRowPress: function(oEvent) {

			var sDialogName = "ReviewAccountingProgram";
			this.mDialogs = this.mDialogs || {};
			var oDialog = this.mDialogs[sDialogName];
			if (!oDialog) {
				oDialog = new ReviewAccountingProgram(this.getView());
				this.mDialogs[sDialogName] = oDialog;

				// For navigation.
				oDialog.setRouter(this.oRouter);
			}

			var context = oEvent.getSource().getBindingContext("accountingsystem");
			oDialog._oControl.setBindingContext(context,"accountingsystem");

			oDialog.open();

		},
		_onDeleteRow: function(oEvent) {

			var sPath = oEvent.getSource().getParent().getBindingContext("accountingsystem").getPath();
			var oResourceBundle = this.getView().getModel("i18n").getResourceBundle();
			if (sPath) {
				return new Promise(function (fnResolve, fnReject) {
				oEvent.getSource().getParent().getModel("accountingsystem").remove(sPath,{
						success: function (oData) {
								fnResolve();
							sap.m.MessageToast.show(oResourceBundle.getText("EntryDeleted"), {
								onClose: fnResolve,
								duration: 0 || 3000
							});
							
							return;
						},
						error: function (oError) {
							MessageBox.show(oError.message.value, {
								icon: sap.m.MessageBox.Icon.ERROR,
								title: "oError"
							});
							return;
						}
					});
				oEvent.getSource().getParent().getModel("accountingsystem").refresh();
			}).catch(function (err) {
					if (err !== undefined) {
						MessageBox.error(err.message);
					}});
		}

		},
		_onEditRow: function(oEvent) {

	var sDialogName = "CreateNewAccountingProgram";
			this.mDialogs = this.mDialogs || {};
			var oDialog = this.mDialogs[sDialogName];
			if (!oDialog) {
				oDialog = new CreateNewAccountingProgram(this.getView());
				this.mDialogs[sDialogName] = oDialog;

				// For navigation.
				oDialog.setRouter(this.oRouter);
			}
			// Set the Binding Context to the Dialog
			var context = oEvent.getSource().getBindingContext("accountingsystem");
			oDialog._oControl.setBindingContext(context,"accountingsystem");
			oDialog._Event = oEvent.getSource().getId();
			oDialog.open();

		},

			openlink: function (oEvent) {
				var sLink = "";
				var filename = oEvent.getSource().getText();
				RepoService.getRepoId().then(function (ReposId) {
					sLink = "/DMSservice/cmis/json/" + ReposId + "/root" + "/" + filename;
					window.open(sLink);
				});
			},

			/**
			 *@memberOf pwc.portal.eval.ClubEvaluations.view.Applications.BudgetReview42G.controller.MainBudgetReview
			 */
			onUpdateFinish: function (oEvent) {
				//This code was generated by the layout editor.

			}
		});
	}, /* bExport= */
	true);