sap.ui.define([
		"pwc/portal/eval/ClubEvaluations/controller/BaseController",
		"sap/m/MessageBox",
		"./ReviewBudgetReview",
		"./utilities",
		"sap/ui/model/json/JSONModel",
		"sap/ui/core/routing/History",
		"pwc/portal/eval/ClubEvaluations/service/RepoService",
		"./CreateNewBudgetReview"
	], function (BaseController, MessageBox, ReviewBudgetReview, Utilities, JSONModel, History, RepoService,CreateNewBudgetReview) {
		"use strict";
		return BaseController.extend("pwc.portal.eval.ClubEvaluations.view.Applications.BudgetReview42G.controller.Page1", {

			club_dms_id: '',
			onInit: function () {

				var that = this;
				this.getOwnerComponent().getModel("User").read("/UserClub", {
				success: function (oData) {
						that.club_dms_id = oData.results[0].club_dms_id;
				},
				error: function (oError) {}
			});
			},
		// onAfterRendering: function () {
  //              if (typeof sap.ui.getCore().AppContext === 'undefined') {
  //                  this.getOwnerComponent().getRouter().navTo("home");
  //                  this.destroy();
  //              }
  //          },
		_onButtonPress: function(oEvent) {

			var sDialogName = "CreateNewBudgetReview";
			this.mDialogs = this.mDialogs || {};
			var oDialog = this.mDialogs[sDialogName];
			if (!oDialog) {
				oDialog = new CreateNewBudgetReview(this.getView());
				this.mDialogs[sDialogName] = oDialog;

				// For navigation.
				oDialog.setRouter(this.oRouter);
			}

			var oContext = this.getView().getModel("EstimatedBudget").createEntry("/estimatedbudgetreview");
			oDialog._oControl.setBindingContext(oContext,"EstimatedBudget");

			oDialog.open();

		},
		_onRowPress: function(oEvent) {

			var sDialogName = "ReviewBudgetReview";
			this.mDialogs = this.mDialogs || {};
			var oDialog = this.mDialogs[sDialogName];
			if (!oDialog) {
				oDialog = new ReviewBudgetReview(this.getView());
				this.mDialogs[sDialogName] = oDialog;

				// For navigation.
				oDialog.setRouter(this.oRouter);
			}

			var context = oEvent.getSource().getBindingContext("EstimatedBudget");
			oDialog._oControl.setBindingContext(context,"EstimatedBudget");

			oDialog.open();

		},
		_onDeleteRow: function(oEvent) {

			var sPath = oEvent.getSource().getParent().getBindingContext("EstimatedBudget").getPath();
			var oResourceBundle = this.getView().getModel("i18n").getResourceBundle();
			if (sPath) {
				return new Promise(function (fnResolve, fnReject) {
				oEvent.getSource().getParent().getModel("EstimatedBudget").remove(sPath,{
						success: function (oData) {
								fnResolve();
							sap.m.MessageToast.show(oResourceBundle.getText("EntryDeleted"), {
								onClose: fnResolve,
								duration: 0 || 3000
							});
							
							return;
						},
						error: function (oError) {
							MessageBox.show(oError.message.value, {
								icon: sap.m.MessageBox.Icon.ERROR,
								title: "oError"
							});
							return;
						}
					});
				oEvent.getSource().getParent().getModel("EstimatedBudget").refresh();
			}).catch(function (err) {
					if (err !== undefined) {
						MessageBox.error(err.message);
					}});
		}

		},
		_onEditRow: function(oEvent) {

	var sDialogName = "CreateNewBudgetReview";
			this.mDialogs = this.mDialogs || {};
			var oDialog = this.mDialogs[sDialogName];
			if (!oDialog) {
				oDialog = new CreateNewBudgetReview(this.getView());
				this.mDialogs[sDialogName] = oDialog;

				// For navigation.
				oDialog.setRouter(this.oRouter);
			}
			// Set the Binding Context to the Dialog
			var context = oEvent.getSource().getBindingContext("EstimatedBudget");
			oDialog._oControl.setBindingContext(context,"EstimatedBudget");
			oDialog._Event = oEvent.getSource().getId();
			oDialog.open();

		},

			/**
			 *@memberOf pwc.portal.eval.ClubEvaluations.view.Applications.BudgetReview42G.controller.MainBudgetReview
			 */
			onUpdateFinish: function (oEvent) {
				//This code was generated by the layout editor.

			}
		});
	}, /* bExport= */
	true);